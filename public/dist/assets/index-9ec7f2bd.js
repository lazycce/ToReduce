import{d as e,a,c as t,e as l,_ as n,r as s,p as o,q as r,w as u,b as i,g as d,s as c,j as p,k as v,v as f,x as m,N as g,y,z as _,t as h,A as w,B as k,i as x,f as b,u as T,o as C,C as j}from"./index-e19c5bd5.js";import{_ as B}from"./lodash-022d070e.js";const U={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},q=[l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"},null,-1),l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"},null,-1)],N=e({name:"Add",render:function(e,l){return a(),t("svg",U,q)}}),z={class:"preview"},G=n({__name:"EditModal",emits:["success"],setup(e,{expose:t,emit:n}){const T=n,C=s(!1),j=s({name:"",type:"",content:"",contentType:"GBK",progress:0}),U=s(""),q=s(!1);s([]);const G=s(null),K=s(),M=()=>{var e;null==(e=K.value)||e.validate((e=>{e||(async()=>{await x.invoke(b.addNovel,B.cloneDeep(j.value)),C.value=!1,T("success")})()}))},A=e=>{const{file:a}=e;G.value=a,F(a)},F=e=>{q.value=!0;try{if(e&&"text/plain"===e.type){const a=new FileReader;a.onload=e=>{j.value.content=e.target.result,U.value=e.target.result<=200?e.target.result:e.target.result.substring(0,200)},a.readAsText(e.file,j.value.contentType),j.value.name=e.file.name.replace(".txt","")}}finally{q.value=!1}},R=()=>{F(G.value)},D=()=>{j.value={name:"",type:"",content:"",contentType:"GBK",progress:0},q.value=!1},I={name:{required:!0,message:"请输入小说名称",trigger:"blur"},content:{required:!0,message:"请选择txt文件",trigger:"change"},contentType:{required:!0,message:"请选择文件编码",trigger:"change"}};return t({show:()=>{C.value=!0}}),(e,t)=>{const n=o("n-icon"),s=o("NUpload");return a(),r(d(k),{to:"body",show:C.value,"onUpdate:show":t[3]||(t[3]=e=>C.value=e),onClose:D},{default:u((()=>[i(d(w),{style:{width:"350px"}},{footer:u((()=>[i(d(c),{justify:"center"},{default:u((()=>[i(d(p),{loading:q.value,type:"primary",onClick:t[2]||(t[2]=e=>M())},{default:u((()=>t[6]||(t[6]=[v("确 定")]))),_:1},8,["loading"])])),_:1})])),default:u((()=>[i(d(f),{ref_key:"formRef",ref:K,model:j.value,"label-placement":"left","label-width":"auto",size:"small",rules:I},{default:u((()=>[i(d(m),{label:"选择文件",path:"content"},{default:u((()=>[i(s,{max:1,"response-type":"blob",accept:".txt","show-file-list":!0,"on-change":A},{default:u((()=>[i(d(p),{size:"small",type:"primary"},{icon:u((()=>[i(n,null,{default:u((()=>[i(d(N))])),_:1})])),_:1})])),_:1})])),_:1}),i(d(m),{label:"小说名称",path:"name"},{default:u((()=>[i(d(g),{value:j.value.name,"onUpdate:value":t[0]||(t[0]=e=>j.value.name=e),placeholder:"请输入小说名称"},null,8,["value"])])),_:1}),i(d(m),{label:"文件编码",path:"contentType"},{default:u((()=>[i(d(y),{value:j.value.contentType,"onUpdate:value":t[1]||(t[1]=e=>j.value.contentType=e),onChange:R},{default:u((()=>[i(d(c),null,{default:u((()=>[i(d(_),{value:"GBK"},{default:u((()=>t[4]||(t[4]=[v(" GBK ")]))),_:1}),i(d(_),{value:"UTF-8"},{default:u((()=>t[5]||(t[5]=[v(" UTF-8 ")]))),_:1})])),_:1})])),_:1},8,["value"])])),_:1}),i(d(m),{label:"内容预览"},{default:u((()=>[l("div",z,h(U.value),1)])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["show"])}}},[["__scopeId","data-v-59bdcb08"]]),K={class:"app-container"},M=["onClick"],A={class:"title"},F=n({__name:"index",setup(e){const n=T(),r=s([]),v=async()=>{const e=await x.invoke(b.selectNovelList);r.value=e.reverse().map(((e,a)=>({no:a+1,...e})))},f=s();return C((()=>{v()})),(e,s)=>{const m=o("n-icon"),g=o("n-progress");return a(),t("div",K,[i(d(c),{reverse:"",style:{width:"100%","margin-bottom":"8px"}},{default:u((()=>[i(d(p),{circle:"",type:"primary",onClick:s[0]||(s[0]=e=>{f.value.show()})},{icon:u((()=>[i(m,null,{default:u((()=>[i(d(N))])),_:1})])),_:1})])),_:1}),i(d(j),{class:"list-container","item-size":42,items:r.value,"padding-top":"4","padding-bottom":"4"},{default:u((({item:e})=>[(a(),t("div",{class:"item-wrapper",key:e.id},[l("div",{class:"item",onClick:a=>(e=>{n.push({name:"readDetail",query:{data:JSON.stringify(e)}})})(e)},[l("div",A,[l("span",null,h(e.no)+". ",1),l("span",null,h(e.name),1)]),l("div",null,[i(g,{style:{width:"180px"},type:"line",percentage:e.progress,height:12,"show-indicator":!1,"border-radius":4,"fill-border-radius":0},null,8,["percentage"])])],8,M)]))])),_:1},8,["items"]),i(G,{ref_key:"editModalRef",ref:f,onSuccess:s[1]||(s[1]=e=>v())},null,512)])}}},[["__scopeId","data-v-7f2ea46a"]]);export{F as default};
